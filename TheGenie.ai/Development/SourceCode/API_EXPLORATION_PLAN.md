# TheGenie.ai API Exploration Plan for Reporting

**Source:** [https://app.thegenie.ai/help](https://app.thegenie.ai/help)  
**Goal:** Leverage existing API endpoints to simplify report generation and avoid complex SQL

---

## üéØ Priority 1: APIs That Could Replace SQL Queries

### 1. `POST api/Data/GetPropertyCollectionReport`
**What it might do:** Return pre-built campaign report with all metrics  
**Why it matters:** Could eliminate need for complex SQL entirely  
**Test with:** Dave Higgins, Campaign ID 16819, October 2025

**Expected Request:**
```json
{
  "UserId": "0c9b9f2a-cf6c-490b-b07b-17e41b9bee50",
  "PropertyCollectionDetailId": 16819,
  "IncludeSmsMetrics": true,
  "IncludeLeadMetrics": true,
  "IncludeCostMetrics": true
}
```

**Expected Response:**
```json
{
  "CampaignName": "...",
  "CampaignDate": "2025-10-15",
  "MessagesSent": 74,
  "SuccessRate": 97.3,
  "Clicks": 5,
  "CTR": 8.17,
  "Leads": 2,
  "OptOuts": 2,
  "TwilioCost": 1.87,
  "AgentNotifications": 2,
  "AgentNotificationCost": 0.45
}
```

---

### 2. `POST api/Data/GetSmsReportSendQueueStatus`
**What it does:** Check status of SMS report queue (Stage 2 of our 3-stage system)  
**Why it matters:** Can diagnose WHERE October 2025 campaigns failed  
**Test with:** Dave Higgins, October 2025 date range

**Expected Request:**
```json
{
  "UserId": "0c9b9f2a-cf6c-490b-b07b-17e41b9bee50",
  "AreaId": 9610,
  "StartDate": "2025-10-01",
  "EndDate": "2025-10-31"
}
```

**Expected Response:**
```json
{
  "QueueItems": [
    {
      "SmsReportSendQueueId": 12345,
      "PropertyCollectionDetailId": 16819,
      "Status": "Failed",
      "ResponseCode": -1,
      "ResponseDescription": "Template not found",
      "CreateDate": "2025-10-15T10:30:00",
      "ProcessDate": null
    }
  ]
}
```

---

### 3. `POST api/Data/GetPropertyCastLog`
**What it does:** Get execution log for PropertyCast campaigns  
**Why it matters:** Shows if campaigns were created, processed, and what actions were taken  
**Test with:** Dave Higgins, October 2025

**Expected Request:**
```json
{
  "UserId": "0c9b9f2a-cf6c-490b-b07b-17e41b9bee50",
  "AreaId": 9610,
  "StartDate": "2025-10-01",
  "EndDate": "2025-10-31",
  "PropertyCastTypeId": 1  // Assuming 1 = Competition Command
}
```

---

### 4. `POST api/Data/GetSmsStatistics`
**What it does:** Get SMS delivery statistics for a campaign  
**Why it matters:** Pre-calculated success rates, costs, delivery metrics  
**Test with:** Campaign 16819

**Expected Request:**
```json
{
  "PropertyCollectionDetailId": 16819
}
```

**Expected Response:**
```json
{
  "TotalSent": 74,
  "Delivered": 72,
  "Failed": 2,
  "SuccessRate": 97.3,
  "TotalCost": 1.87,
  "AverageCostPerMessage": 0.025,
  "OptOuts": 2,
  "Clicks": 5,
  "ClickThroughRate": 6.76
}
```

---

### 5. `POST api/Data/GetLeadsByPropertyCollection`
**What it does:** Get all leads generated by a campaign  
**Why it matters:** Provides engagement metrics (CTA clicks, verifications, lead details)  
**Test with:** Campaign 16819

**Expected Request:**
```json
{
  "PropertyCollectionDetailId": 16819,
  "IncludeEngagementDetails": true
}
```

**Expected Response:**
```json
{
  "Leads": [
    {
      "GenieLeadId": 12345,
      "FirstName": "John",
      "LastName": "Doe",
      "PhoneNumber": "+15551234567",
      "CreateDate": "2025-10-15T14:23:00",
      "CtaClicked": true,
      "CtaVerified": true,
      "ReferringUrl": "https://app.thegenie.ai/..."
    }
  ],
  "TotalLeads": 2,
  "CtaClicks": 5,
  "CtaVerifications": 2
}
```

---

## üîß Priority 2: Diagnostic & Admin APIs

### 6. `POST api/Data/GetWorkflowStatus`
**What it does:** Check status of workflow queue items  
**Why it matters:** Diagnose Stage 1 ‚Üí Stage 2 failures

### 7. `POST api/Data/GetPropertyCollectionOptimizationStatus`
**What it does:** Check if property collection optimization completed  
**Why it matters:** Campaigns can't send until optimization is done

### 8. `POST api/Data/GetPhoneNumberFromTwilioNumber`
**What it does:** Map Twilio pool numbers back to actual recipient numbers  
**Why it matters:** Needed for accurate recipient lists

---

## üìä Priority 3: Supporting Data APIs

### 9. `POST api/Data/GetPropertyCollection`
**What it does:** Get property collection details (campaign metadata)  
**Why it matters:** Campaign name, area, property count, create date

### 10. `POST api/Data/GetUser` / `POST api/Data/GetUserProfile/{id}`
**What it does:** Get agent profile information  
**Why it matters:** Agent name, company, contact info for report header

### 11. `POST api/Data/GetAreaName`
**What it does:** Get area marketing name (with user customizations)  
**Why it matters:** Solves the "Area ID vs Area Name" problem we had!

---

## üöÄ Recommended Hybrid Approach

### Option A: Pure API Solution (Ideal)
```python
def generate_monthly_report(user_id, area_id, month):
    # 1. Get all campaigns for the month
    campaigns = api.get_property_collections(user_id, area_id, month)
    
    # 2. For each campaign, get pre-built metrics
    report_data = []
    for campaign in campaigns:
        metrics = api.get_property_collection_report(campaign.id)
        sms_stats = api.get_sms_statistics(campaign.id)
        leads = api.get_leads_by_property_collection(campaign.id)
        
        report_data.append({
            **metrics,
            **sms_stats,
            **leads.summary
        })
    
    # 3. Generate Excel from clean data
    create_excel_report(report_data)
```

**Pros:**
- ‚úÖ Simple, clean code
- ‚úÖ Uses proven business logic
- ‚úÖ Future-proof
- ‚úÖ No SQL maintenance

**Cons:**
- ‚ùå Multiple API calls per campaign
- ‚ùå Depends on API availability
- ‚ùå May hit rate limits

---

### Option B: Hybrid SQL + API (Pragmatic)
```python
def generate_monthly_report(user_id, area_id, month):
    # 1. Get campaign list from SQL (fast, simple query)
    campaigns = db.query("""
        SELECT PropertyCollectionDetailId, Name, CreateDate
        FROM PropertyCollectionDetail
        WHERE AspNetUserId = ? AND AreaId = ? AND ...
    """)
    
    # 2. For each campaign, use API for complex metrics
    for campaign in campaigns:
        # API handles all the complex joins and calculations
        metrics = api.get_property_collection_report(campaign.id)
        report_data.append(metrics)
    
    # 3. Generate Excel
    create_excel_report(report_data)
```

**Pros:**
- ‚úÖ Fast campaign listing
- ‚úÖ Reliable metrics from API
- ‚úÖ Best of both worlds

**Cons:**
- ‚ùå Still depends on both SQL and API

---

### Option C: SQL with API Fallback (Current Path)
```python
def generate_monthly_report(user_id, area_id, month):
    # 1. Try SQL query first
    try:
        report_data = db.execute_complex_query(...)
    except:
        # 2. Fall back to API if SQL fails
        report_data = api_based_report(user_id, area_id, month)
    
    # 3. Generate Excel
    create_excel_report(report_data)
```

---

## üß™ Testing Plan

### Phase 1: API Discovery (30 minutes)
1. Test `GetPropertyCollectionReport` - Does it exist?
2. Test `GetSmsStatistics` - What format does it return?
3. Test `GetPropertyCastLog` - Can we see October 2025 campaigns?
4. Test `GetSmsReportSendQueueStatus` - Can we diagnose failures?

**Tools needed:**
- API authentication (API key or bearer token)
- Postman or Python `requests` library
- Dave Higgins credentials/ID

---

### Phase 2: Compare API vs SQL (1 hour)
1. Get Dave Higgins November 2024 data via API
2. Get same data via SQL
3. Compare results
4. Identify discrepancies

---

### Phase 3: Build Hybrid Solution (2 hours)
1. Use API for metrics where available
2. Use SQL for campaign lists and basic data
3. Combine into unified report
4. Test with multiple agents/months

---

## üîê API Authentication

Based on the help page, TheGenie API likely uses:
- **Bearer Token** authentication
- **API Key** in header
- **User ID** + **Secret** combination

**Need to determine:**
1. How do we get API credentials?
2. What's the base URL? (likely `https://app.thegenie.ai/api/Data/...`)
3. Are there rate limits?
4. Do we need special permissions?

---

## üìù Next Steps

1. **Ask user:** Do you have API credentials for TheGenie.ai?
2. **Test:** `POST api/Data/GetPropertyCollectionReport` endpoint
3. **Diagnose:** `POST api/Data/GetSmsReportSendQueueStatus` for October 2025
4. **Compare:** API results vs our SQL query results
5. **Build:** Hybrid solution using best of both approaches

---

## üí° Key Insight

The API likely powers the TheGenie.ai web dashboard. If the dashboard shows correct campaign metrics, the API MUST have the correct data and logic. This means:

‚úÖ API knows how to distinguish audience vs agent SMS  
‚úÖ API knows how to parse CustomData JSON  
‚úÖ API knows how to calculate success rates and costs  
‚úÖ API has access to real-time Twilio data  

**Using the API is like having the original developers build the report for us.**

---

**Status:** Ready to test API endpoints  
**Blocker:** Need API credentials  
**ETA to solution:** 2-3 hours after API access confirmed

