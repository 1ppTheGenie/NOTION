Versium Cache Migration - Complete Findings & Analysis
Version: 1.0
Created: 12/16/2025
Last Updated: 12/16/2025
Author: Cursor AI Assistant

================================================================================
EXECUTIVE SUMMARY
================================================================================

✅ ANALYSIS COMPLETE
✅ QUERIES WORKING
✅ KEY QUESTIONS ANSWERED
✅ TEST ACCOUNTS IDENTIFIED
✅ READY FOR TESTING

================================================================================
ANSWERS TO YOUR QUESTIONS
================================================================================

Q1: When did the switch from First American (DataTree) to Attom happen?
-----------------------------------------------------------------------
A: The switch has NOT fully happened yet.

Timeline:
• 11/06/2025: Attom integration code completed (TaxDataParser service)
• 12/14/2025: AttomId mappings created (1.6M rows in AssessorDataPropertyMap)
• 12/14/2025: Cache migration procedure created
• 12/16/2025: System STILL using DataTree PropertyIDs for cache

Status: PRE-MIGRATION
• Attom data is available
• Mappings are ready
• Migration procedure is ready
• Application still uses DataTree IDs for cache lookups

Q2: Is any data being cached since moving to Attom?
---------------------------------------------------
A: YES - Data is being cached, but using OLD DataTree PropertyIDs.

Evidence:
• Cache entries created TODAY (12/16/2025 14:45:19)
• Recent PropertyIDs: 15237408, 15237455, 15237895 (all DataTree range)
• These PropertyIDs are NOT in Attom mapping table
• System is still generating cache keys with DataTree PropertyIDs

CRITICAL INSIGHT:
----------------
Every day we delay migration, more cache entries are created with old PropertyIDs.
These will become orphaned when the system switches to Attom IDs.

URGENT ACTION NEEDED:
-------------------
Execute migration BEFORE switching application to Attom IDs.

================================================================================
TEST ACCOUNTS - PROPERTIES FOUND
================================================================================

CAMPBELL (893ffd3f-1bb7-441f-ae58-0fecb1e680df):
------------------------------------------------
Reports Found: Multiple reports in ViewCollectionReport
Properties: Accessible via PropertyCollection table
Status: Ready for testing

HIGGINS (23d254fe-792f-44b2-b40f-9b1d7a12189d):
-----------------------------------------------
Reports Found: Report 234159 "7875 Skyline Blvd - Sold - SMS"
Properties Found: 20+ properties including:
• PropertyID 9781775 (DataTree ID)
• PropertyID 9781771 (DataTree ID)
• PropertyID 155176603 (Attom ID - high range!)
• PropertyID 9773042 (DataTree ID)
• PropertyID 9773307 (DataTree ID)
... and more

MIXED PROPERTYIDs:
-----------------
• Most properties use DataTree IDs (9M range)
• Some properties use Attom IDs (155M range)
• This confirms system is in transition

================================================================================
DATABASE SCHEMA DISCOVERIES
================================================================================

CORRECTED UNDERSTANDING:
-----------------------
❌ No "Account" table → ✅ Use AspNetUsers + AspNetUserProfiles
❌ No "Optimization" table → ✅ Use PropertyCollection + ViewCollectionReport
❌ Direct PropertyID in reports → ✅ PropertyCollection.PropertyId

CORRECT LINKAGE:
---------------
ViewCollectionReport
  → PropertyCollectionDetailId
    → PropertyCollection (PropertyCollectionDetailId)
      → PropertyId
        → DataAppendContactLookup (cache entries)

WORKING QUERIES:
--------------
✅ Query 1: User details (AspNetUsers + AspNetUserProfiles)
✅ Query 2: Properties from reports (PropertyCollection join)
✅ Query 3: Cache entries for report properties
✅ Query 4: Summary by report (fixed aggregate issue)
✅ Query 5: Recent cache entries analysis

================================================================================
CACHE STATUS ANALYSIS
================================================================================

RECENT CACHE ENTRIES (Since 12/14/2025):
----------------------------------------
• PropertyID 15237408 - DataTree ID, No Attom mapping
• PropertyID 15237455 - DataTree ID, No Attom mapping
• PropertyID 15237895 - DataTree ID, No Attom mapping
• PropertyID 15237406 - DataTree ID, No Attom mapping
• PropertyID 15236730 - DataTree ID, No Attom mapping

PropertyID Ranges:
-----------------
• DataTree IDs: 4,134,346 → 180,808,347 (mid range, 4M-180M)
• Attom IDs: 88,530 → 1,003,268,533 (high range, typically > 100M)
• Recent entries: All in DataTree range (15M range)

CONCLUSION:
----------
System is STILL using DataTree PropertyIDs for Versium cache lookups,
even though Attom integration is complete and mappings are ready.

================================================================================
MIGRATION READINESS
================================================================================

✅ MAPPING TABLE: FarmGenie.dbo.CachePropertyIdMapping
   • 3,226,651 total rows
   • 680,182 with Attom mappings (21.1%)
   • Created: 12/14/2025

✅ MIGRATION PROCEDURE: dbo.usp_MigrateVersiumCache_DataTreeToAttom
   • Preview mode: ✅ Working
   • Execute mode: ✅ Ready
   • Batch processing: ✅ Implemented
   • Backup creation: ✅ Automatic

✅ ATTOM MAPPINGS: TitleData.dbo.AssessorDataPropertyMap.AttomId
   • 1,598,561 rows populated
   • Updated: 12/14/2025

⏳ APPLICATION SWITCH: NOT YET DONE
   • Still using DataTree PropertyIDs
   • Cache entries still created with old IDs
   • Switch should happen AFTER migration

================================================================================
TESTING PLAN - UPDATED
================================================================================

STEP 1: ✅ Run Analysis Queries (COMPLETED)
------------------------------------------
• User details retrieved
• Properties from reports identified
• Cache entries located
• Migration status determined

STEP 2: Select Test Properties
-------------------------------
From Query Results:
• Select 5-10 properties per account
• Mix of: DataTree IDs + Attom IDs
• Mix of: Properties with cache + Properties without cache
• Mix of: Properties with Attom mapping + Properties without

STEP 3: Run Optimizations (BEFORE Migration)
--------------------------------------------
• Run optimizations for selected test properties
• Track: Credits used, API calls, cache hits/misses
• This creates "BEFORE" baseline

STEP 4: Run Migration Preview
-------------------------------
• Execute: EXEC dbo.usp_MigrateVersiumCache_DataTreeToAttom @PreviewMode = 1
• Review: How many cache entries would be updated
• Verify: Sample of before/after cache keys

STEP 5: Execute Migration
-------------------------
• Execute: EXEC dbo.usp_MigrateVersiumCache_DataTreeToAttom @PreviewMode = 0
• Monitor: Progress and completion
• Verify: Cache entries updated

STEP 6: Run Optimizations (AFTER Migration)
-------------------------------------------
• Run optimizations for SAME test properties
• Track: Credits used, API calls, cache hits/misses
• This creates "AFTER" comparison

STEP 7: Compare Results
-----------------------
• Compare: Credits before vs after
• Compare: API calls before vs after
• Calculate: Credit savings
• Validate: Migration success

================================================================================
FILES CREATED
================================================================================

✅ Versium_Cache_Test_Queries_FINAL.sql
   • Working queries using Report IDs
   • Fixed schema issues
   • Ready to run

✅ Versium_Cache_Migration_Findings_v1.docx
   • Key findings document
   • Answers to your questions
   • Technical discoveries

✅ Versium_Cache_Migration_Complete_Findings_v1.docx (this file)
   • Complete analysis
   • All findings consolidated
   • Ready for executive review

================================================================================
RECOMMENDATIONS
================================================================================

IMMEDIATE:
---------
1. ✅ Review query results (DONE)
2. ⏳ Select test properties from results
3. ⏳ Run optimizations for test properties
4. ⏳ Execute migration preview
5. ⏳ Execute migration
6. ⏳ Validate results

URGENT:
------
• Execute migration BEFORE application switches to Attom IDs
• Every day of delay = more cache entries to migrate
• Current cache entries are safe (migration ready)

FUTURE:
------
• After migration: Switch application to use Attom PropertyIDs
• Monitor: Cache hit rates should improve
• Re-run mapping: As Attom expands state coverage

================================================================================
CHANGE LOG
================================================================================

Version 1.0 (12/16/2025)
- Complete findings document created
- Answered all questions about switch date and caching
- Documented database schema discoveries
- Identified critical insight about ongoing cache creation
- Created working queries using Report IDs
- Consolidated all analysis into one document

